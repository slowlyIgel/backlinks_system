<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title></title>
    <style media="screen">
      .linkgroup{border:1px solid #aaa;margin: 20px auto;padding:4%;}
    </style>
  </head>
  <body>
    n_id:<span id="n_id">{{n_id}}</span>
    <!-- <textarea id="original" rows="30" cols="100">{{original_data}}</textarea><br>
    <button type="button" name="button" onclick="changeLinkSytle()">submit</button><br>
    Seperate%%GROUP%%Here<br>
    Seperate%%GROUPNMAE%%Here -->
    <div style="width:60%;margin:50px auto;">
    {% for eachgroup in group %}
    <div class="linkgroup">
      <button type="button" style="float:right;" onclick="deletegroup(this)">刪除此群組</button>
      <button type="button" style="float:right;" onclick="addnewinGroup(this)">新增</button>
      群組名稱：<input type="text" name="groupname" value="{{eachgroup["groupname"]}}"><br>
      內容：<br>
      {% for link in eachgroup["grouplink"] %}
      <div class="eachlinkingroup">
        <input type="text" name="link" value="{{link["link"]}}" style="width:60%;">
        <input type="text" name="anchor" value="{{link["anchor"]}}" style="width:30%;">
        <button type="button" onclick="removethisline(this)">刪除</button><br>
      </div>
      {% endfor %}
    </div>
    {% endfor %}
    <button type="button" onclick="addgroup(this)">新增群組</button>
    <button type="button" style="float:right;" onclick="submit()">儲存</button>
  </div>
  </body>
</html>
<script src="https://code.jquery.com/jquery-3.1.1.min.js" integrity="sha256-hVVnYaiADRTO2PzUGmuLJr8BLUSjGIZsDYGmIJLv2b8=" crossorigin="anonymous"></script>
<script type="text/javascript">
  function changeLinkSytle(){
    var original_data = $("#original").val();
    var n_id = $("#n_id").html();
      $.post("/ajax/upload_newtypelink/"+n_id,{change:original_data},function(){
        alert("good~~");
      });
  }
  function addnewinGroup(field){
    var adding = "<div class=\"eachlinkingroup\"><input type=\"text\" name=\"link\" value=\"\" style=\"width:60%;\"><input type=\"text\" name=\"anchor\" value=\"\" style=\"width:30%;\"><button type=\"button\" onclick=\"removethisline(this)\">刪除</button><br></div>";
    $(field).parents(".linkgroup").append(adding);
  }
  function removethisline(field){
    $(field).parent(".eachlinkingroup").remove();
  }
  function submit(){
    var finalstorage = "";
    $(".linkgroup").each(function(){
      finalstorage += $(this).children("input[name=groupname]").val();
      finalstorage += "Seperate%%GROUPNMAE%%Here";
      $(this).children(".eachlinkingroup").each(function(){
        finalstorage += "<a href=\""+$(this).children("input[name=link]").val()+"\">";
        finalstorage += $(this).children("input[name=anchor]").val()+"</a>";
      });
      if (!$(this).is($(".linkgroup").last())) {
        finalstorage += "Seperate%%GROUP%%Here";
      }
    });
    var n_id = $("#n_id").html();
      $.post("/ajax/upload_newtypelink/"+n_id,{change:finalstorage},function(){
        alert("good~~");
      });
  }
  function addgroup(field){
    var group = "<div class=\"linkgroup\"><button type=\"button\" style=\"float:right;\" onclick=\"deletegroup(this)\">刪除此群組</button><button type=\"button\" name=\"button\" style=\"float:right;\" onclick=\"addnewinGroup(this)\">新增</button>群組名稱：<input type=\"text\" name=\"groupname\" value=\"\"><br>內容：<br><div class=\"eachlinkingroup\"><input type=\"text\" name=\"link\" value=\"\" style=\"width:60%;\"><input type=\"text\" name=\"anchor\" value=\"\" style=\"width:30%;\"><button type=\"button\" onclick=\"removethisline(this)\">刪除</button><br></div></div>";
    $(group).insertBefore(field);
  }
  function deletegroup(field){
    $(field).parents(".linkgroup").remove();
  }
</script>
