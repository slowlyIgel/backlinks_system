{% extends 'backlink_model.twig' %}
{% block style %}
.export{min-width:100px;min-height:100px;position:fixed;bottom:3%;left:0;padding:15px;}
.export button {display:block;margin:auto;}
td, th {padding:5px;}
{% endblock %}
{% block main_stage %}
<table>
  <tr>
    <th>選擇匯出</th>
    <th>現在檢查用日期</th>
    <th>案件名稱</th>
    <th>外鏈群組</th>
    <th>外鏈類型</th>
    <th>案件產業</th>
    <th>群組備註</th>
    <th>已匯出</th>
  </tr>
  {% for eachSubmitRecord in everySubmitRecord %}
  <tr case_id="{{eachSubmitRecord["case_id"]}}" group_id="{{eachSubmitRecord["backlinkGroup_id"]}}">
    <td>
      <input type="checkbox" name="selectexport" value="" checked="checked">
    </td>
    <td>{{eachSubmitRecord["submit_time"]}}</td>
    <td name="caseName">{{eachSubmitRecord["case_name"]}}</td>
    <td>{{groupChinese[ eachSubmitRecord["backlinkGroup_id"] ]}}</td>
    <td  name="LinkType" type_id="{{eachSubmitRecord["linktype_thisweek"]}}">{{eachSubmitRecord["BacklinkType_name"]}}</td>
    <td>{{eachSubmitRecord["industry_name"]}}</td>
    <td>{{eachSubmitRecord["remark"]}}</td>
    <td>{{eachSubmitRecord["export"]}}</td>
  </tr>
  {% endfor %}
</table>
<div id="forexportContent"></div>
<div class="export">
  <label>拆檔:</label><input type="text" id="SeperateToNFile" value=""><br><br>
  <button type="button" onclick="create_export_file()">匯出</button>
</div>
{% endblock %}
{% block script_stage %}
<script type="text/javascript">
  function create_export_file(){
    var ContentIndex = "<form  action=\"\/export\/backlink_data\" method=\"post\">";
    var i = 0;
    $("tr[case_id][group_id]").has("input:checked").each(function(){
      ContentIndex += "<input type=\"hidden\" name=\"ContentIndex["+ i +"][case_id]\" value="+$(this).attr("case_id")+">";
      ContentIndex += "<input type=\"hidden\" name=\"ContentIndex["+ i +"][group_id_incase]\" value="+$(this).attr("group_id")+">";
      ContentIndex += "<input type=\"hidden\" name=\"CaseName[]\" value="+$(this).children("td[name=caseName]").html()+">";
      ContentIndex += "<input type=\"hidden\" name=\"LinkType[]\" value="+$(this).children("td[name=LinkType]").attr("type_id")+">";
      i += 1;
    });
    if ($.isNumeric($("#SeperateToNFile").val())) {
      ContentIndex += "<input type=\"hidden\" name=\"SeperateTo\" value="+$("#SeperateToNFile").val()+">";
    }
    ContentIndex += "<\/form>";
    $(ContentIndex).submit();
  }

</script>
{% endblock %}
